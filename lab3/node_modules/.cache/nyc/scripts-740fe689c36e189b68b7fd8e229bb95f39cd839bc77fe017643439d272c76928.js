function cov_sgj6dmn4e(){var path="/home/viktor/Documents/TDP013/tdp013_gruppc_vikro653_danhu849/lab3/lib/public/scripts.js";var hash="2bfb5ec2f89ee8abfc5449455638e42b44c2db26";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"/home/viktor/Documents/TDP013/tdp013_gruppc_vikro653_danhu849/lab3/lib/public/scripts.js",statementMap:{"0":{start:{line:5,column:2},end:{line:8,column:3}},"1":{start:{line:7,column:4},end:{line:7,column:13}},"2":{start:{line:13,column:14},end:{line:13,column:48}},"3":{start:{line:14,column:2},end:{line:14,column:32}},"4":{start:{line:16,column:13},end:{line:16,column:56}},"5":{start:{line:19,column:2},end:{line:21,column:3}},"6":{start:{line:20,column:4},end:{line:20,column:33}},"7":{start:{line:27,column:12},end:{line:27,column:43}},"8":{start:{line:28,column:2},end:{line:35,column:3}},"9":{start:{line:30,column:4},end:{line:30,column:44}},"10":{start:{line:34,column:4},end:{line:34,column:40}},"11":{start:{line:37,column:2},end:{line:41,column:4}},"12":{start:{line:47,column:15},end:{line:47,column:26}},"13":{start:{line:48,column:16},end:{line:48,column:27}},"14":{start:{line:49,column:16},end:{line:49,column:28}},"15":{start:{line:50,column:15},end:{line:50,column:44}},"16":{start:{line:51,column:2},end:{line:51,column:36}},"17":{start:{line:52,column:2},end:{line:52,column:31}},"18":{start:{line:54,column:17},end:{line:54,column:48}},"19":{start:{line:55,column:2},end:{line:55,column:29}},"20":{start:{line:56,column:2},end:{line:56,column:63}},"21":{start:{line:58,column:2},end:{line:65,column:3}},"22":{start:{line:59,column:4},end:{line:59,column:47}},"23":{start:{line:60,column:4},end:{line:60,column:28}},"24":{start:{line:63,column:4},end:{line:63,column:43}},"25":{start:{line:64,column:4},end:{line:64,column:29}},"26":{start:{line:68,column:2},end:{line:68,column:51}},"27":{start:{line:71,column:17},end:{line:71,column:52}},"28":{start:{line:72,column:2},end:{line:72,column:53}},"29":{start:{line:77,column:18},end:{line:77,column:53}},"30":{start:{line:78,column:12},end:{line:78,column:27}},"31":{start:{line:79,column:13},end:{line:79,column:56}},"32":{start:{line:80,column:13},end:{line:80,column:33}},"33":{start:{line:82,column:2},end:{line:94,column:4}},"34":{start:{line:89,column:4},end:{line:93,column:5}},"35":{start:{line:90,column:6},end:{line:90,column:22}},"36":{start:{line:92,column:6},end:{line:92,column:25}},"37":{start:{line:95,column:2},end:{line:95,column:20}},"38":{start:{line:100,column:19},end:{line:107,column:4}},"39":{start:{line:106,column:4},end:{line:106,column:21}},"40":{start:{line:109,column:2},end:{line:109,column:53}},"41":{start:{line:109,column:30},end:{line:109,column:52}}},fnMap:{"0":{name:"enter",decl:{start:{line:4,column:9},end:{line:4,column:14}},loc:{start:{line:4,column:22},end:{line:9,column:1}},line:4},"1":{name:"tooLongMessage",decl:{start:{line:11,column:9},end:{line:11,column:23}},loc:{start:{line:12,column:0},end:{line:22,column:1}},line:12},"2":{name:"(anonymous_2)",decl:{start:{line:19,column:17},end:{line:19,column:18}},loc:{start:{line:19,column:28},end:{line:21,column:3}},line:19},"3":{name:"markRead",decl:{start:{line:25,column:9},end:{line:25,column:17}},loc:{start:{line:26,column:0},end:{line:42,column:1}},line:26},"4":{name:"createMessage",decl:{start:{line:44,column:9},end:{line:44,column:22}},loc:{start:{line:45,column:0},end:{line:73,column:1}},line:45},"5":{name:"addMsg",decl:{start:{line:75,column:9},end:{line:75,column:15}},loc:{start:{line:76,column:0},end:{line:96,column:1}},line:76},"6":{name:"(anonymous_6)",decl:{start:{line:88,column:10},end:{line:88,column:11}},loc:{start:{line:88,column:24},end:{line:94,column:3}},line:88},"7":{name:"listMsgs",decl:{start:{line:98,column:15},end:{line:98,column:23}},loc:{start:{line:99,column:0},end:{line:110,column:1}},line:99},"8":{name:"(anonymous_8)",decl:{start:{line:105,column:10},end:{line:105,column:11}},loc:{start:{line:105,column:24},end:{line:107,column:3}},line:105},"9":{name:"(anonymous_9)",decl:{start:{line:109,column:19},end:{line:109,column:20}},loc:{start:{line:109,column:30},end:{line:109,column:52}},line:109}},branchMap:{"0":{loc:{start:{line:5,column:2},end:{line:8,column:3}},type:"if",locations:[{start:{line:5,column:2},end:{line:8,column:3}},{start:{line:5,column:2},end:{line:8,column:3}}],line:5},"1":{loc:{start:{line:28,column:2},end:{line:35,column:3}},type:"if",locations:[{start:{line:28,column:2},end:{line:35,column:3}},{start:{line:28,column:2},end:{line:35,column:3}}],line:28},"2":{loc:{start:{line:58,column:2},end:{line:65,column:3}},type:"if",locations:[{start:{line:58,column:2},end:{line:65,column:3}},{start:{line:58,column:2},end:{line:65,column:3}}],line:58},"3":{loc:{start:{line:89,column:4},end:{line:93,column:5}},type:"if",locations:[{start:{line:89,column:4},end:{line:93,column:5}},{start:{line:89,column:4},end:{line:93,column:5}}],line:89}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0},b:{"0":[0,0],"1":[0,0],"2":[0,0],"3":[0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"2bfb5ec2f89ee8abfc5449455638e42b44c2db26"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];{// @ts-ignore
cov_sgj6dmn4e=function(){return actualCoverage;};}return actualCoverage;}cov_sgj6dmn4e();function enter(event){cov_sgj6dmn4e().f[0]++;cov_sgj6dmn4e().s[0]++;if(event.keyCode==13){cov_sgj6dmn4e().b[0][0]++;cov_sgj6dmn4e().s[1]++;addMsg();}else{cov_sgj6dmn4e().b[0][1]++;}}function tooLongMessage(){cov_sgj6dmn4e().f[1]++;var modal=(cov_sgj6dmn4e().s[2]++,document.getElementById("myModal"));cov_sgj6dmn4e().s[3]++;modal.style.display="block";var span=(cov_sgj6dmn4e().s[4]++,document.getElementsByClassName("close")[0]);// When the user clicks on <span> (x), close the modal
cov_sgj6dmn4e().s[5]++;span.onclick=function(){cov_sgj6dmn4e().f[2]++;cov_sgj6dmn4e().s[6]++;modal.style.display="none";};}// Changed the msgbox color depending on change of checkbox.
function markRead(dateID){cov_sgj6dmn4e().f[3]++;let msg=(cov_sgj6dmn4e().s[7]++,document.getElementById(dateID));cov_sgj6dmn4e().s[8]++;if(msg.childNodes[0].checked==true){cov_sgj6dmn4e().b[1][0]++;cov_sgj6dmn4e().s[9]++;msg.setAttribute("class","readMsgBox");}else{cov_sgj6dmn4e().b[1][1]++;cov_sgj6dmn4e().s[10]++;msg.setAttribute("class","msgBox");}cov_sgj6dmn4e().s[11]++;fetch('http://localhost:3000/flag',{headers:{'Content-Type':'application/json'},method:'POST',body:JSON.stringify({_id:dateID})});}function createMessage(msgData){cov_sgj6dmn4e().f[4]++;// Lägger in meddelanden på rad.
let dateId=(cov_sgj6dmn4e().s[12]++,msgData._id);let message=(cov_sgj6dmn4e().s[13]++,msgData.msg);let msgRead=(cov_sgj6dmn4e().s[14]++,msgData.flag);let msgBox=(cov_sgj6dmn4e().s[15]++,document.createElement('div'));cov_sgj6dmn4e().s[16]++;msgBox.setAttribute("id",dateId);cov_sgj6dmn4e().s[17]++;msgBox.textContent=message;let checkbox=(cov_sgj6dmn4e().s[18]++,document.createElement('input'));cov_sgj6dmn4e().s[19]++;checkbox.type='checkbox';cov_sgj6dmn4e().s[20]++;checkbox.setAttribute("onchange",`markRead(${msgBox.id});`);// Adds a function dynamically to the checkbox.
cov_sgj6dmn4e().s[21]++;if(msgRead){cov_sgj6dmn4e().b[2][0]++;cov_sgj6dmn4e().s[22]++;msgBox.setAttribute("class","readMsgBox");cov_sgj6dmn4e().s[23]++;checkbox.checked=true;}else{cov_sgj6dmn4e().b[2][1]++;cov_sgj6dmn4e().s[24]++;msgBox.setAttribute("class","msgBox");cov_sgj6dmn4e().s[25]++;checkbox.checked=false;}// Puts checkbox before the text in the msgbox.
cov_sgj6dmn4e().s[26]++;msgBox.insertBefore(checkbox,msgBox.firstChild);// Makes sure last message is seen at the top of msgs.
let messages=(cov_sgj6dmn4e().s[27]++,document.getElementById('messages'));cov_sgj6dmn4e().s[28]++;messages.insertBefore(msgBox,messages.firstChild);}function addMsg(){cov_sgj6dmn4e().f[5]++;let textField=(cov_sgj6dmn4e().s[29]++,document.getElementById('postText'));let msg=(cov_sgj6dmn4e().s[30]++,textField.value);let data=(cov_sgj6dmn4e().s[31]++,{msg:msg,flag:false,_id:Date.now()});let body=(cov_sgj6dmn4e().s[32]++,JSON.stringify(data));cov_sgj6dmn4e().s[33]++;fetch('http://localhost:3000/save',{headers:{'Content-Type':'application/json'},method:'POST',body:body}).then(function(res){cov_sgj6dmn4e().f[6]++;cov_sgj6dmn4e().s[34]++;if(res.status==400){cov_sgj6dmn4e().b[3][0]++;cov_sgj6dmn4e().s[35]++;tooLongMessage();}else{cov_sgj6dmn4e().b[3][1]++;cov_sgj6dmn4e().s[36]++;createMessage(data);}});cov_sgj6dmn4e().s[37]++;textField.value='';}async function listMsgs(){cov_sgj6dmn4e().f[7]++;const messages=(cov_sgj6dmn4e().s[38]++,await fetch('http://localhost:3000/getall',{headers:{'Content-Type':'application/json'},method:'GET'}).then(function(res){cov_sgj6dmn4e().f[8]++;cov_sgj6dmn4e().s[39]++;return res.json();}));cov_sgj6dmn4e().s[40]++;messages.forEach(message=>{cov_sgj6dmn4e().f[9]++;cov_sgj6dmn4e().s[41]++;return createMessage(message);});}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNjcmlwdHMuanMiXSwibmFtZXMiOlsiZW50ZXIiLCJldmVudCIsImtleUNvZGUiLCJhZGRNc2ciLCJ0b29Mb25nTWVzc2FnZSIsIm1vZGFsIiwiZG9jdW1lbnQiLCJnZXRFbGVtZW50QnlJZCIsInN0eWxlIiwiZGlzcGxheSIsInNwYW4iLCJnZXRFbGVtZW50c0J5Q2xhc3NOYW1lIiwib25jbGljayIsIm1hcmtSZWFkIiwiZGF0ZUlEIiwibXNnIiwiY2hpbGROb2RlcyIsImNoZWNrZWQiLCJzZXRBdHRyaWJ1dGUiLCJmZXRjaCIsImhlYWRlcnMiLCJtZXRob2QiLCJib2R5IiwiSlNPTiIsInN0cmluZ2lmeSIsIl9pZCIsImNyZWF0ZU1lc3NhZ2UiLCJtc2dEYXRhIiwiZGF0ZUlkIiwibWVzc2FnZSIsIm1zZ1JlYWQiLCJmbGFnIiwibXNnQm94IiwiY3JlYXRlRWxlbWVudCIsInRleHRDb250ZW50IiwiY2hlY2tib3giLCJ0eXBlIiwiaWQiLCJpbnNlcnRCZWZvcmUiLCJmaXJzdENoaWxkIiwibWVzc2FnZXMiLCJ0ZXh0RmllbGQiLCJ2YWx1ZSIsImRhdGEiLCJEYXRlIiwibm93IiwidGhlbiIsInJlcyIsInN0YXR1cyIsImxpc3RNc2dzIiwianNvbiIsImZvckVhY2giXSwibWFwcGluZ3MiOiI4OUtBZVk7eUZBWlosUUFBU0EsQ0FBQUEsS0FBVCxDQUFlQyxLQUFmLENBQXNCLCtDQUNwQixHQUFJQSxLQUFLLENBQUNDLE9BQU4sRUFBaUIsRUFBckIsQ0FDQSxrREFDRUMsTUFBTSxHQUNQLENBSEQsZ0NBSUQsQ0FFRCxRQUFTQyxDQUFBQSxjQUFULEVBQ0Esd0JBQ0UsR0FBSUMsQ0FBQUEsS0FBSyx5QkFBR0MsUUFBUSxDQUFDQyxjQUFULENBQXdCLFNBQXhCLENBQUgsQ0FBVCxDQURGLHVCQUVFRixLQUFLLENBQUNHLEtBQU4sQ0FBWUMsT0FBWixDQUFzQixPQUF0QixDQUVBLEdBQUlDLENBQUFBLElBQUkseUJBQUdKLFFBQVEsQ0FBQ0ssc0JBQVQsQ0FB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IGlmIChldmVudC5rZXlDb2RlID09IDEzKVxuICB7XG4gICAgYWRkTXNnKCk7XG4gIH1cbn1cblxuZnVuY3Rpb24gdG9vTG9uZ01lc3NhZ2UoKVxue1xuICB2YXIgbW9kYWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcIm15TW9kYWxcIik7XG4gIG1vZGFsLnN0eWxlLmRpc3BsYXkgPSBcImJsb2NrXCI7XG5cbiAgdmFyIHNwYW4gPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKFwiY2xvc2VcIilbMF07XG5cbiAgLy8gV2hlbiB0aGUgdXNlciBjbGlja3Mgb24gPHNwYW4+ICh4KSwgY2xvc2UgdGhlIG1vZGFsXG4gIHNwYW4ub25jbGljayA9IGZ1bmN0aW9uKCkge1xuICAgIG1vZGFsLnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjtcbiAgfVxufVxuXG4vLyBDaGFuZ2VkIHRoZSBtc2dib3ggY29sb3IgZGVwZW5kaW5nIG9uIGNoYW5nZSBvZiBjaGVja2JveC5cbmZ1bmN0aW9uIG1hcmtSZWFkKGRhdGVJRClcbntcbiAgbGV0IG1zZyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGRhdGVJRCk7XG4gIGlmIChtc2cuY2hpbGROb2Rlc1swXS5jaGVja2VkID09IHRydWUpXG4gIHtcbiAgICBtc2cuc2V0QXR0cmlidXRlKFwiY2xhc3NcIiwgXCJyZWFkTXNnQm94XCIpO1xuICB9XG4gIGVsc2VcbiAge1xuICAgIG1zZy5zZXRBdHRyaWJ1dGUoXCJjbGFzc1wiLCBcIm1zZ0JveFwiKTtcbiAgfVxuXG4gIGZldGNoKCdodHRwOi8vbG9jYWxob3N0OjMwMDAvZmxhZycsIHtcbiAgICBoZWFkZXJzOiB7J0NvbnRlbnQtVHlwZScgOiAnYXBwbGljYXRpb24vanNvbid9LFxuICAgIG1ldGhvZDogJ1BPU1QnLFxuICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHtfaWQgOiBkYXRlSUR9KVxuICB9KVxufVxuXG5mdW5jdGlvbiBjcmVhdGVNZXNzYWdlKG1zZ0RhdGEpXG57XG4gIC8vIEzDpGdnZXIgaW4gbWVkZGVsYW5kZW4gcMOlIHJhZC5cbiAgbGV0IGRhdGVJZCA9IG1zZ0RhdGEuX2lkO1xuICBsZXQgbWVzc2FnZSA9IG1zZ0RhdGEubXNnO1xuICBsZXQgbXNnUmVhZCA9IG1zZ0RhdGEuZmxhZztcbiAgbGV0IG1zZ0JveCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICBtc2dCb3guc2V0QXR0cmlidXRlKFwiaWRcIiwgZGF0ZUlkKTtcbiAgbXNnQm94LnRleHRDb250ZW50ID0gbWVzc2FnZTsgIFxuXG4gIGxldCBjaGVja2JveCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2lucHV0Jyk7XG4gIGNoZWNrYm94LnR5cGUgPSAnY2hlY2tib3gnO1xuICBjaGVja2JveC5zZXRBdHRyaWJ1dGUoXCJvbmNoYW5nZVwiLCBgbWFya1JlYWQoJHttc2dCb3guaWR9KTtgKTsgLy8gQWRkcyBhIGZ1bmN0aW9uIGR5bmFtaWNhbGx5IHRvIHRoZSBjaGVja2JveC5cbiAgXG4gIGlmIChtc2dSZWFkKSB7XG4gICAgbXNnQm94LnNldEF0dHJpYnV0ZShcImNsYXNzXCIsIFwicmVhZE1zZ0JveFwiKTtcbiAgICBjaGVja2JveC5jaGVja2VkID0gdHJ1ZTtcbiAgfVxuICBlbHNlIHtcbiAgICBtc2dCb3guc2V0QXR0cmlidXRlKFwiY2xhc3NcIiwgXCJtc2dCb3hcIik7XG4gICAgY2hlY2tib3guY2hlY2tlZCA9IGZhbHNlO1xuICB9XG5cbiAgLy8gUHV0cyBjaGVja2JveCBiZWZvcmUgdGhlIHRleHQgaW4gdGhlIG1zZ2JveC5cbiAgbXNnQm94Lmluc2VydEJlZm9yZShjaGVja2JveCwgbXNnQm94LmZpcnN0Q2hpbGQpO1xuXG4gIC8vIE1ha2VzIHN1cmUgbGFzdCBtZXNzYWdlIGlzIHNlZW4gYXQgdGhlIHRvcCBvZiBtc2dzLlxuICBsZXQgbWVzc2FnZXMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWVzc2FnZXMnKTtcbiAgbWVzc2FnZXMuaW5zZXJ0QmVmb3JlKG1zZ0JveCwgbWVzc2FnZXMuZmlyc3RDaGlsZCk7XG59XG5cbmZ1bmN0aW9uIGFkZE1zZygpXG57XG4gIGxldCB0ZXh0RmllbGQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncG9zdFRleHQnKTtcbiAgbGV0IG1zZyA9IHRleHRGaWVsZC52YWx1ZTtcbiAgbGV0IGRhdGEgPSB7bXNnIDogbXNnLCBmbGFnIDogZmFsc2UsIF9pZCA6IERhdGUubm93KCl9XG4gIGxldCBib2R5ID0gSlNPTi5zdHJpbmdpZnkoZGF0YSlcblxuICBmZXRjaCgnaHR0cDovL2xvY2FsaG9zdDozMDAwL3NhdmUnLCB7IFxuICAgICAgaGVhZGVyczoge1xuICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJ1xuICAgICAgfSxcbiAgICAgIG1ldGhvZDogJ1BPU1QnLFxuICAgICAgYm9keTogYm9keVxuICB9KS50aGVuKGZ1bmN0aW9uKHJlcykge1xuICAgIGlmIChyZXMuc3RhdHVzID09IDQwMCkge1xuICAgICAgdG9vTG9uZ01lc3NhZ2UoKVxuICAgIH0gZWxzZSB7XG4gICAgICBjcmVhdGVNZXNzYWdlKGRhdGEpXG4gICAgfVxuICB9KSAgXG4gIHRleHRGaWVsZC52YWx1ZT0nJ1xufVxuXG5hc3luYyBmdW5jdGlvbiBsaXN0TXNncygpXG57ICBcbiAgY29uc3QgbWVzc2FnZXMgPSBhd2FpdCBmZXRjaCgnaHR0cDovL2xvY2FsaG9zdDozMDAwL2dldGFsbCcsIHtcbiAgICBoZWFkZXJzOiB7XG4gICAgICAnQ29udGVudC1UeXBlJyA6ICdhcHBsaWNhdGlvbi9qc29uJ1xuICAgIH0sXG4gICAgbWV0aG9kOiAnR0VUJ1xuICB9KS50aGVuKGZ1bmN0aW9uKHJlcykge1xuICAgIHJldHVybiByZXMuanNvbigpXG4gIH0pXG5cbiAgbWVzc2FnZXMuZm9yRWFjaChtZXNzYWdlID0+IGNyZWF0ZU1lc3NhZ2UobWVzc2FnZSkpXG59Il19